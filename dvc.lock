schema: '2.0'
stages:
  prepare_annotations:
    cmd: poetry run python ./src/ner/convert_bliou_to_bio.py ./data/annotation/annotation-result-orig.txt
      ./data/annotation/annotation-result.txt --out data/annotation/annotation-result-BIO.txt
    deps:
    - path: ./src/ner/convert_bliou_to_bio.py
      md5: 58229dba68e2cd8d80fa8ec7f45476c9
      size: 1940
    - path: data/annotation/annotation-result-orig.txt
      md5: f368553363edd3d250db16bfe443e176
      size: 663696
    - path: data/annotation/annotation-result.txt
      md5: a38ba160a65904f4a2f45910221aab64
      size: 1048470
    outs:
    - path: data/annotation/annotation-result-BIO.txt
      md5: 7f18755701f4ec76d05641cba2a305be
      size: 1376730
  prepare_language_model_train_set:
    cmd: poetry run python ./src/ner/flair/prepare_lm_train_files.py ./data/jobs/seek_vacancies.db
    deps:
    - path: ./src/ner/flair/prepare_lm_train_files.py
      md5: 56d1e1751fd8524bf570602a76ab6ff7
      size: 1899
    - path: data/jobs/seek_vacancies.db
      md5: 2c1a32f46b6a7b28cfe1c572b4930f01
      size: 550674432
    params:
      params.yaml:
        flair.language_model_train.corpus_dir: data/corpus/jobs
    outs:
    - path: data/corpus/jobs/train
      md5: 14cd263f9b3a59dfff45f5cf07eb17d9.dir
      size: 373151466
      nfiles: 100
  finetune_backward_lm:
    cmd: poetry run python src/ner/flair/train_language_model.py --out=models/jobs_lm_backward
      --backward
    deps:
    - path: data/corpus/jobs/test.txt
      md5: e6d040005443dc7b485df62ba359f01b
      size: 3791917
    - path: data/corpus/jobs/train
      md5: 14cd263f9b3a59dfff45f5cf07eb17d9.dir
      size: 373151466
      nfiles: 100
    - path: data/corpus/jobs/valid.txt
      md5: 3038a3bec712939157ca4c6186b46df5
      size: 3872807
    - path: src/ner/flair/train_language_model.py
      md5: fae51be9ae8712144ae6ce4afcc333fe
      size: 2856
    params:
      params.yaml:
        flair.language_model_train.num_epochs: 2
    outs:
    - path: models/jobs_lm_backward/best-lm.pt
      md5: ca1793cdab4c1634551e0b6a7294f7a8
      size: 73037215
  prepare_annotations_val:
    cmd: poetry run python ./src/ner/convert_bliou_to_bio.py ./data/annotation/annotation-result-val.txt
      --out data/annotation/annotation-result-BIO-val.txt
    deps:
    - path: ./src/ner/convert_bliou_to_bio.py
      md5: 58229dba68e2cd8d80fa8ec7f45476c9
      size: 1940
    - path: data/annotation/annotation-result-val.txt
      md5: 6c4b909e153e8d976d73983de79fe728
      size: 161741
    outs:
    - path: data/annotation/annotation-result-BIO-val.txt
      md5: 8b2b7ece5ca1ac9d1dbbc5b1b244a526
      size: 129848
  flair_train_ner:
    cmd: poetry run python ./src/ner/flair/train_ner.py
    deps:
    - path: data/annotation/annotation-result-BIO-val.txt
      md5: 8b2b7ece5ca1ac9d1dbbc5b1b244a526
      size: 129848
    - path: data/annotation/annotation-result-BIO.txt
      md5: 7f18755701f4ec76d05641cba2a305be
      size: 1376730
    - path: src/ner/flair/train_ner.py
      md5: c5e10a22e9d057762f45e0b9ffed11c3
      size: 4517
    params:
      params.yaml:
        flair.ner_train.crf: true
        flair.ner_train.num_epochs: 40
        flair.ner_train.rnn: false
    outs:
    - path: models/flair-ner-bert
      md5: 6f2dbbea43c9f9f2d1ce273a175bfe01.dir
      size: 501493701
      nfiles: 6
  prepare_train_ner_dataset_spacy:
    cmd: poetry run python src/ner/spacy/prepare_traning_data.py data/annotation/annotation-result-orig.json
      data/annotation/annotation-result.json --out data/annotation/train.spacy
    deps:
    - path: data/annotation/annotation-result-orig.json
      md5: a20e83324f674ccf3fa87ea0b4ab65d3
      size: 436553
    - path: data/annotation/annotation-result.json
      md5: 9b058f4139b741fe9b72889d9a674d15
      size: 717283
    - path: src/ner/spacy/prepare_traning_data.py
      md5: 936490ef9636be52e825ad8739a47b3d
      size: 1936
    outs:
    - path: data/annotation/train.spacy
      md5: d3e36493b1583aecc9c2c68d8116635f
      size: 1315373
  prepare_validation_ner_dataset_spacy:
    cmd: poetry run python src/ner/spacy/prepare_traning_data.py data/annotation/annotation-result-val.json
      --out data/annotation/validation.spacy
    deps:
    - path: data/annotation/annotation-result-val.json
      md5: 5ef17176ff1b61bfcd09c27fad900479
      size: 115924
    - path: src/ner/spacy/prepare_traning_data.py
      md5: 936490ef9636be52e825ad8739a47b3d
      size: 1936
    outs:
    - path: data/annotation/validation.spacy
      md5: e239f5a311e903e56e6b7223454d65ed
      size: 132700
  spacy_install_eng_model:
    cmd: poetry run python -m spacy download en_core_web_trf
  finetune_forward_lm:
    cmd: poetry run python src/ner/flair/train_language_model.py --out=models/jobs_lm_forward
      --forward
    deps:
    - path: data/corpus/jobs/test.txt
      md5: e6d040005443dc7b485df62ba359f01b
      size: 3791917
    - path: data/corpus/jobs/train
      md5: 14cd263f9b3a59dfff45f5cf07eb17d9.dir
      size: 373151466
      nfiles: 100
    - path: data/corpus/jobs/valid.txt
      md5: 3038a3bec712939157ca4c6186b46df5
      size: 3872807
    - path: src/ner/flair/train_language_model.py
      md5: fae51be9ae8712144ae6ce4afcc333fe
      size: 2856
    params:
      params.yaml:
        flair.language_model_train.num_epochs: 2
    outs:
    - path: models/jobs_lm_forward/best-lm.pt
      md5: f440f7c4f7251b36da6a4a61768692e8
      size: 73037215
  flair_train_ner_with_lang_model:
    cmd: poetry run python ./src/ner/flair/train_ner_with_lang_model.py
    deps:
    - path: data/annotation/annotation-result-BIO-val.txt
      md5: 8b2b7ece5ca1ac9d1dbbc5b1b244a526
      size: 129848
    - path: data/annotation/annotation-result-BIO.txt
      md5: 7f18755701f4ec76d05641cba2a305be
      size: 1376730
    - path: models/jobs_lm_backward/best-lm.pt
      md5: ca1793cdab4c1634551e0b6a7294f7a8
      size: 73037215
    - path: models/jobs_lm_forward/best-lm.pt
      md5: f440f7c4f7251b36da6a4a61768692e8
      size: 73037215
    - path: src/ner/flair/train_ner_with_lang_model.py
      md5: 71af53e13cf47221be340914352a4cc1
      size: 2402
    outs:
    - path: models/flair-ner-lm
      md5: 434c18a1cf55f85d955652de3b500f37.dir
      size: 838964992
      nfiles: 7
