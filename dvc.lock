schema: '2.0'
stages:
  prepare_annotations:
    cmd: pipenv run python ./src/ner/convert_bliou_to_bio.py ./data/annotation/annotation-result-orig.txt
      ./data/annotation/annotation-result.txt --out data/annotation/annotation-result-BIO.txt
    deps:
    - path: ./src/ner/convert_bliou_to_bio.py
      md5: 58229dba68e2cd8d80fa8ec7f45476c9
      size: 1940
    - path: data/annotation/annotation-result-orig.txt
      md5: f368553363edd3d250db16bfe443e176
      size: 663696
    - path: data/annotation/annotation-result.txt
      md5: a38ba160a65904f4a2f45910221aab64
      size: 1048470
    outs:
    - path: data/annotation/annotation-result-BIO.txt
      md5: 7f18755701f4ec76d05641cba2a305be
      size: 1376730
  prepare_language_model_train_set:
    cmd: pipenv run python ./src/ner/flair/prepare_lm_train_files.py ./data/jobs/seek_vacancies.db
    deps:
    - path: ./src/ner/flair/prepare_lm_train_files.py
      md5: 56d1e1751fd8524bf570602a76ab6ff7
      size: 1899
    - path: data/jobs/seek_vacancies.db
      md5: d01f95fd560d5092854627cacb9a7053
      size: 541581312
    params:
      params.yaml:
        flair.language_model_train.corpus_dir: data/corpus/jobs
    outs:
    - path: data/corpus/jobs/train
      md5: 14cd263f9b3a59dfff45f5cf07eb17d9.dir
      size: 373151466
      nfiles: 100
  finetune_backward_lm:
    cmd: pipenv run python src/ner/flair/train_language_model.py --out=models/jobs_lm_backward
      --backward
    deps:
    - path: data/corpus/jobs/test.txt
      md5: e6d040005443dc7b485df62ba359f01b
      size: 3791917
    - path: data/corpus/jobs/train
      md5: 14cd263f9b3a59dfff45f5cf07eb17d9.dir
      size: 373151466
      nfiles: 100
    - path: data/corpus/jobs/valid.txt
      md5: 3038a3bec712939157ca4c6186b46df5
      size: 3872807
    - path: src/ner/flair/train_language_model.py
      md5: fae51be9ae8712144ae6ce4afcc333fe
      size: 2856
    params:
      params.yaml:
        flair.language_model_train.num_epochs: 1
    outs:
    - path: models/jobs_lm_backward/best-lm.pt
      md5: e75f9445cc3d863ef16eb1e8622b86fa
      size: 73037151
    - path: models/jobs_lm_backward/checkpoint.pt
      md5: ab0d64e1da7ee9a4366387edab357880
      size: 73037471
  prepare_annotations_val:
    cmd: pipenv run python ./src/ner/convert_bliou_to_bio.py ./data/annotation/annotation-result-val.txt
      --out data/annotation/annotation-result-BIO-val.txt
    deps:
    - path: ./src/ner/convert_bliou_to_bio.py
      md5: 58229dba68e2cd8d80fa8ec7f45476c9
      size: 1940
    - path: data/annotation/annotation-result-val.txt
      md5: 6c4b909e153e8d976d73983de79fe728
      size: 161741
    outs:
    - path: data/annotation/annotation-result-BIO-val.txt
      md5: 8b2b7ece5ca1ac9d1dbbc5b1b244a526
      size: 129848
  flair_train_ner:
    cmd: pipenv run python ./src/ner/flair/train_ner.py
    deps:
    - path: data/annotation/annotation-result-BIO-val.txt
      md5: 8b2b7ece5ca1ac9d1dbbc5b1b244a526
      size: 129848
    - path: data/annotation/annotation-result-BIO.txt
      md5: 7f18755701f4ec76d05641cba2a305be
      size: 1376730
    - path: models/jobs_lm_backward
      md5: 93093c1ffdae43cb9ca26775c53f0519.dir
      size: 365943795
      nfiles: 7
    - path: models/jobs_lm_forward
      md5: f27de30296858914b7817ea2035bab74.dir
      size: 292741013
      nfiles: 6
    - path: src/ner/flair/train_ner.py
      md5: 377e78af77c05d77c31da8c8f25286b2
      size: 4536
    params:
      params.yaml:
        flair.ner_train.crf: true
        flair.ner_train.num_epochs: 40
        flair.ner_train.rnn: false
    outs:
    - path: models/flair-ner-bert
      md5: 8be5e0b7b820c68cf630bd1dec9e7d86.dir
      size: 998271086
      nfiles: 7
  prepare_train_ner_dataset_spacy:
    cmd: pipenv run python src/ner/spacy/prepare_traning_data.py data/annotation/annotation-result-orig.json
      data/annotation/annotation-result.json --out data/annotation/train.spacy
    deps:
    - path: data/annotation/annotation-result-orig.json
      md5: a20e83324f674ccf3fa87ea0b4ab65d3
      size: 436553
    - path: data/annotation/annotation-result.json
      md5: 9b058f4139b741fe9b72889d9a674d15
      size: 717283
    - path: src/ner/spacy/prepare_traning_data.py
      md5: 936490ef9636be52e825ad8739a47b3d
      size: 1936
    outs:
    - path: data/annotation/train.spacy
      md5: 1f23fba92bfd5521dba5a076a4c44340
      size: 1315374
  prepare_validation_ner_dataset_spacy:
    cmd: pipenv run python src/ner/spacy/prepare_traning_data.py data/annotation/annotation-result-val.json
      --out data/annotation/validation.spacy
    deps:
    - path: data/annotation/annotation-result-val.json
      md5: 5ef17176ff1b61bfcd09c27fad900479
      size: 115924
    - path: src/ner/spacy/prepare_traning_data.py
      md5: 936490ef9636be52e825ad8739a47b3d
      size: 1936
    outs:
    - path: data/annotation/validation.spacy
      md5: e239f5a311e903e56e6b7223454d65ed
      size: 132700
